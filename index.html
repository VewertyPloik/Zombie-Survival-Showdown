<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zombie Survival Showdown</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap');
  body {
    margin: 0;
    background: #202020;
    color: white;
    font-family: 'Comic Neue', cursive, Arial, sans-serif;
    user-select: none;
    overflow: hidden;
  }
  #homeScreen, #gameScreen, #shopScreen, #gameOverScreen, #winScreen {
    position: absolute;
    top:0; left:0; right:0; bottom:0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: #121212;
    z-index: 100;
  }
  #gameScreen, #shopScreen, #gameOverScreen, #winScreen {
    display: none;
  }
  h1 {
    font-size: 3.5rem;
    margin-bottom: 20px;
    text-shadow: 2px 2px #00cc00;
  }
  button {
    background: #00cc00;
    border: none;
    border-radius: 10px;
    font-size: 1.5rem;
    padding: 12px 30px;
    margin: 10px;
    color: #111;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
  }
  button:hover {
    background: #00ee00;
  }
  #gameCanvas {
    background: #1a1a1a;
    border: 5px solid #00cc00;
    border-radius: 20px;
    display: block;
    margin: 20px auto;
    box-shadow: 0 0 15px #00cc00aa;
  }
  #infoBar {
    display: flex;
    justify-content: space-around;
    margin-top: 5px;
    font-size: 1.3rem;
  }
  #healthBarContainer {
    width: 250px;
    height: 25px;
    border: 2px solid white;
    border-radius: 12px;
    overflow: hidden;
    background: #440000;
  }
  #healthBar {
    height: 100%;
    background: #00cc00;
    width: 100%;
    transition: width 0.3s;
  }
  #coinsDisplay {
    font-weight: bold;
    color: #ffff55;
  }
  #waveDisplay {
    font-weight: bold;
    color: #00ffcc;
  }
  #shopItems {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 10px;
  }
  .shopItem {
    background: #222;
    border: 2px solid #00cc00;
    border-radius: 10px;
    margin: 10px;
    padding: 10px 15px;
    width: 180px;
    cursor: pointer;
    color: white;
    user-select: none;
    transition: background 0.3s;
  }
  .shopItem:hover {
    background: #004400;
  }
  .shopItem.disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  .shopItem h3 {
    margin: 5px 0;
    font-size: 1.3rem;
  }
  .shopItem p {
    margin: 3px 0;
    font-size: 1rem;
  }
</style>
</head>
<body>

<!-- HOME SCREEN -->
<div id="homeScreen">
  <h1>Zombie Survival Showdown</h1>
  <button id="startBtn">Start Fighting</button>
  <p style="margin-top: 20px; font-size: 1.2rem;">Survive 25 waves of zombies! üßü‚Äç‚ôÇÔ∏èüßüüßü‚Äç‚ôÄÔ∏è</p>
</div>

<!-- GAME SCREEN -->
<div id="gameScreen">
  <canvas id="gameCanvas" width="800" height="450"></canvas>
  <div id="infoBar">
    <div>Health: 
      <div id="healthBarContainer"><div id="healthBar"></div></div>
    </div>
    <div id="coinsDisplay">Coins: 0 üí∞</div>
    <div id="waveDisplay">Wave: 1/25</div>
  </div>
</div>

<!-- SHOP SCREEN -->
<div id="shopScreen">
  <h1>Shop - Upgrade Your Arsenal</h1>
  <div id="coinsDisplayShop" style="font-size:1.5rem; color: #ffff55;"></div>
  <div id="shopItems">
    <!-- Items will be dynamically created -->
  </div>
  <button id="continueBtn" style="margin-top: 25px;">Continue to Next Wave</button>
</div>

<!-- GAME OVER SCREEN -->
<div id="gameOverScreen">
  <h1>Game Over</h1>
  <p id="gameOverText" style="font-size: 1.8rem; margin: 20px;"></p>
  <button id="restartBtn">Restart</button>
</div>

<!-- WIN SCREEN -->
<div id="winScreen">
  <h1>Congratulations!</h1>
  <p style="font-size: 1.8rem; margin: 20px;">You survived all 25 waves! üßü‚Äç‚ôÇÔ∏èüí•üôé‚Äç‚ôÇÔ∏è</p>
  <button id="winRestartBtn">Play Again</button>
</div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  // DOM elements
  const homeScreen = document.getElementById('homeScreen');
  const gameScreen = document.getElementById('gameScreen');
  const shopScreen = document.getElementById('shopScreen');
  const gameOverScreen = document.getElementById('gameOverScreen');
  const winScreen = document.getElementById('winScreen');

  const startBtn = document.getElementById('startBtn');
  const restartBtn = document.getElementById('restartBtn');
  const winRestartBtn = document.getElementById('winRestartBtn');

  const continueBtn = document.getElementById('continueBtn');

  const healthBar = document.getElementById('healthBar');
  const coinsDisplay = document.getElementById('coinsDisplay');
  const coinsDisplayShop = document.getElementById('coinsDisplayShop');
  const waveDisplay = document.getElementById('waveDisplay');
  const gameOverText = document.getElementById('gameOverText');
  const shopItemsContainer = document.getElementById('shopItems');

  // Sounds
  const sounds = {
    knife: new Audio('https://actions.google.com/sounds/v1/weapons/knife_stab.ogg'),
    pistol: new Audio('https://actions.google.com/sounds/v1/weapons/pistol_shot.ogg'),
    rifle: new Audio('https://actions.google.com/sounds/v1/weapons/automatic_rifle.ogg'),
    shotgun: new Audio('https://actions.google.com/sounds/v1/weapons/shotgun_fire.ogg'),
    rocket: new Audio('https://actions.google.com/sounds/v1/explosions/explosion_large.ogg'),
    hit: new Audio('https://actions.google.com/sounds/v1/human_voices/gasp.ogg'),
    zombieGrowl: new Audio('https://actions.google.com/sounds/v1/creatures/zombie_growl_1.ogg'),
    gameOver: new Audio('https://actions.google.com/sounds/v1/cartoon/slide_whistle_down.ogg'),
    win: new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg'),
  };

  // Adjust volume
  for(let s in sounds) sounds[s].volume = 0.15;

  // Game constants
  const PLAYER_START_HEALTH = 100;
  const WAVE_TOTAL = 25;
  const SHOP_TIME = 10 * 1000; // 10 seconds shop interval

  // Weapons definition
  const weapons = [
    {
      name: "Knife",
      cost: 0,
      damage: 10,
      emoji: "üî™",
      sfx: sounds.knife,
      desc: "Basic melee weapon, infinite uses",
      unlocked: true,
    },
    {
      name: "Pistol",
      cost: 50,
      damage: 25,
      emoji: "üî´",
      sfx: sounds.pistol,
      desc: "Basic handgun, better range",
      unlocked: false,
    },
    {
      name: "Rifle",
      cost: 1000,
      damage: 60,
      emoji: "üî´üî´",
      sfx: sounds.rifle,
      desc: "Powerful automatic rifle",
      unlocked: false,
    },
    {
      name: "Shotgun",
      cost: 5000,
      damage: 120,
      emoji: "üî´üî´üî´",
      sfx: sounds.shotgun,
      desc: "Close range but heavy damage",
      unlocked: false,
    },
    {
      name: "Rocket Launcher",
      cost: 25000,
      damage: 300,
      emoji: "üöÄ",
      sfx: sounds.rocket,
      desc: "Huge explosive damage, limited ammo",
      unlocked: false,
    }
  ];

  // Game state
  let player = {
    x: canvas.width / 2,
    y: canvas.height - 70,
    width: 35,
    height: 50,
    health: PLAYER_START_HEALTH,
    coins: 0,
    weaponIndex: 0,
    speed: 6,
    isAttacking: false,
    attackCooldown: 0,
    facing: 'right',
  };

  let zombies = [];
  let wave = 1;
  let gameRunning = false;
  let inShop = false;
  let waveInterval = null;
  let shopTimeout = null;
  let keysPressed = {};
  let lastAttackTime = 0;
  let rocketAmmo = 0;

  // Helper functions
  function playSfx(sound) {
    if (!sound) return;
    sound.currentTime = 0;
    sound.play();
  }

  // Create zombies based on wave number
  function spawnZombies(waveNum) {
    zombies = [];
    const baseCount = Math.min(5 + waveNum * 2, 60);
    const baseHealth = 10 + waveNum * 5;
    const baseSpeed = 0.7 + waveNum * 0.05;

    for(let i=0; i<baseCount; i++) {
      let side = Math.random() < 0.5 ? 'left' : 'right';
      zombies.push({
        x: side === 'left' ? -30 - Math.random() * 300 : canvas.width + 30 + Math.random() * 300,
        y: canvas.height - 70 - (Math.random() * 50),
        width: 40,
        height: 60,
        health: baseHealth,
        maxHealth: baseHealth,
        speed: baseSpeed + Math.random() * 0.4,
        side: side,
        emoji: ["üßü","üßü‚Äç‚ôÄÔ∏è","üßü‚Äç‚ôÇÔ∏è"][Math.floor(Math.random()*3)],
        alive: true,
      });
    }
  }

  // Reset player for new game
  function resetPlayer() {
    player.health = PLAYER_START_HEALTH;
    player.coins = 0;
    player.weaponIndex = 0;
    rocketAmmo = 0;
    player.x = canvas.width / 2;
    player.y = canvas.height - 70;
    player.isAttacking = false;
    player.attackCooldown = 0;
    player.facing = 'right';
  }

  // Show / hide screens
  function showScreen(screen) {
    [homeScreen, gameScreen, shopScreen, gameOverScreen, winScreen].forEach(s => {
      s.style.display = 'none';
    });
    screen.style.display = 'flex';
  }

  // Draw player
  function drawPlayer() {
    ctx.font = '50px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'bottom';

    // Player body emoji
    ctx.fillText('üôé‚Äç‚ôÇÔ∏è', player.x, player.y + player.height);

    // Draw weapon emoji near player facing direction
    const weaponEmoji = weapons[player.weaponIndex].emoji;
    const offsetX = player.facing === 'right' ? 25 : -25;

    ctx.font = '32px Arial';
    ctx.fillText(weaponEmoji, player.x + offsetX, player.y + player.height - 20);
  }

  // Draw zombies
  function drawZombies() {
    ctx.font = '45px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'bottom';

    zombies.forEach(z => {
      if (!z.alive) return;
      ctx.fillText(z.emoji, z.x, z.y + z.height);

      // Draw health bar above zombie
      ctx.fillStyle = 'red';
      ctx.fillRect(z.x - 20, z.y + z.height - 65, 40, 5);
      ctx.fillStyle = 'lime';
      ctx.fillRect(z.x - 20, z.y + z.height - 65, 40 * (z.health / z.maxHealth), 5);
    });
  }

  // Draw UI info bars
  function updateUI() {
    const healthPercent = Math.max(0, player.health) / PLAYER_START_HEALTH * 100;
    healthBar.style.width = healthPercent + '%';
    if(healthPercent > 60) {
      healthBar.style.background = '#00cc00';
    } else if (healthPercent > 30) {
      healthBar.style.background = '#ffcc00';
    } else {
      healthBar.style.background = '#cc0000';
    }
    coinsDisplay.textContent = `Coins: ${player.coins} üí∞`;
    coinsDisplayShop.textContent = `Coins: ${player.coins} üí∞`;
    waveDisplay.textContent = `Wave: ${wave}/${WAVE_TOTAL}`;
  }

  // Move player left/right with arrow keys or A/D
  function movePlayer() {
    if(keysPressed['ArrowLeft'] || keysPressed['a']) {
      player.x -= player.speed;
      player.facing = 'left';
    }
    if(keysPressed['ArrowRight'] || keysPressed['d']) {
      player.x += player.speed;
      player.facing = 'right';
    }
    player.x = Math.max(30, Math.min(canvas.width - 30, player.x));
  }

  // Check collision between rectangles
  function rectCollide(ax, ay, aw, ah, bx, by, bw, bh) {
    return ax < bx + bw &&
           ax + aw > bx &&
           ay < by + bh &&
           ah + ay > by;
  }

  // Attack zombies with current weapon
  function attack() {
    if (Date.now() - lastAttackTime < 500) return; // cooldown
    lastAttackTime = Date.now();
    player.isAttacking = true;

    let weapon = weapons[player.weaponIndex];
    playSfx(weapon.sfx);

    // Check for zombies in front (attack range)
    const attackRange = 100;

    // Calculate hitbox in front of player
    const attackX = player.facing === 'right' ? player.x : player.x - attackRange;
    zombies.forEach(z => {
      if(!z.alive) return;
      // Zombie rectangle
      let zx = z.x - 20, zy = z.y, zw = 40, zh = 60;
      // Attack rectangle
      let ax = attackX, ay = player.y, aw = attackRange, ah = 60;
      if(player.facing === 'left') {
        ax = attackX;
      }
      if(rectCollide(ax, ay, aw, ah, zx, zy, zw, zh)) {
        z.health -= weapon.damage;
        if(z.health <= 0) {
          z.alive = false;
          player.coins += 5 + wave; // coins per kill
          playSfx(sounds.hit);
        }
      }
    });

    // Special for rocket launcher: damages all zombies on screen heavily and consumes ammo
    if (weapon.name === "Rocket Launcher") {
      if(rocketAmmo <= 0) {
        // No ammo, play empty sound
        return;
      }
      rocketAmmo--;
      zombies.forEach(z => {
        if(!z.alive) return;
        z.health -= weapon.damage;
        if(z.health <= 0) {
          z.alive = false;
          player.coins += 5 + wave;
          playSfx(sounds.hit);
        }
      });
    }
  }

  // Zombies move toward player
  function updateZombies() {
    zombies.forEach(z => {
      if(!z.alive) return;

      // Move zombie toward player x
      if (z.x < player.x) {
        z.x += z.speed;
      } else {
        z.x -= z.speed;
      }

      // Simple vertical bobbing (walking effect)
      z.y += Math.sin(Date.now()/500 + z.x) * 0.2;

      // If zombie hits player
      const zombieRect = {x: z.x - 20, y: z.y, width: 40, height: 60};
      const playerRect = {x: player.x - player.width/2, y: player.y, width: player.width, height: player.height};
      if(rectCollide(zombieRect.x, zombieRect.y, zombieRect.width, zombieRect.height,
                    playerRect.x, playerRect.y, playerRect.width, playerRect.height)) {
        // Damage player every 700ms if in contact
        if(!z.lastHitTime || Date.now() - z.lastHitTime > 700) {
          player.health -= 5 + wave * 0.5;
          z.lastHitTime = Date.now();
          playSfx(sounds.zombieGrowl);
          if(player.health <= 0) {
            endGame(false);
          }
        }
      }
    });
  }

  // Remove dead zombies
  function cleanZombies() {
    zombies = zombies.filter(z => z.alive);
  }

  // Game loop
  function gameLoop() {
    if (!gameRunning) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    movePlayer();
    updateZombies();

    drawZombies();
    drawPlayer();

    updateUI();

    // Check if all zombies dead to progress
    if(zombies.length === 0) {
      nextWaveOrShop();
      return;
    }

    requestAnimationFrame(gameLoop);
  }

  // When wave ends or game start, move to shop or next wave
  function nextWaveOrShop() {
    if (wave >= WAVE_TOTAL) {
      // Player won
      endGame(true);
      return;
    }
    gameRunning = false;
    inShop = true;
    showScreen(shopScreen);
    renderShopItems();
  }

  // End game, win = true or lose = false
  function endGame(win) {
    gameRunning = false;
    inShop = false;
    if(win) {
      playSfx(sounds.win);
      showScreen(winScreen);
    } else {
      playSfx(sounds.gameOver);
      gameOverText.textContent = `You survived wave ${wave}/${WAVE_TOTAL}. Try again!`;
      showScreen(gameOverScreen);
    }
  }

  // Start next wave
  function startWave() {
    inShop = false;
    wave++;
    spawnZombies(wave);
    showScreen(gameScreen);
    gameRunning = true;
    updateUI();
    gameLoop();
  }

  // Render shop items dynamically
  function renderShopItems() {
    shopItemsContainer.innerHTML = "";
    weapons.forEach((w, i) => {
      if(i === 0) return; // Skip knife in shop (always unlocked)
      const div = document.createElement('div');
      div.className = 'shopItem';
      if(player.coins < w.cost) div.classList.add('disabled');
      if(player.weaponIndex >= i) div.classList.add('disabled');

      div.innerHTML = `
        <h3>${w.emoji} ${w.name}</h3>
        <p>${w.desc}</p>
        <p>Cost: ${w.cost.toLocaleString()} üí∞</p>
      `;

      div.onclick = () => {
        if(div.classList.contains('disabled')) return;
        if(player.coins >= w.cost) {
          player.coins -= w.cost;
          player.weaponIndex = i;
          if(w.name === "Rocket Launcher") {
            rocketAmmo = 3; // Give 3 rockets
          }
          updateUI();
          renderShopItems();
          playSfx(w.sfx);
        }
      };

      shopItemsContainer.appendChild(div);
    });
  }

  // Handle controls
  window.addEventListener('keydown', e => {
    keysPressed[e.key] = true;
    if(!gameRunning) return;
    if(e.key === ' ' || e.key === 'Enter') {
      attack();
    }
  });

  window.addEventListener('keyup', e => {
    keysPressed[e.key] = false;
  });

  // Buttons
  startBtn.onclick = () => {
    resetPlayer();
    wave = 0;
    startWave();
    showScreen(gameScreen);
  };

  restartBtn.onclick = () => {
    showScreen(homeScreen);
  };

  winRestartBtn.onclick = () => {
    showScreen(homeScreen);
  };

  continueBtn.onclick = () => {
    if(inShop) {
      showScreen(gameScreen);
      gameRunning = true;
      inShop = false;
      spawnZombies(wave);
      gameLoop();
    }
  };

  // Show home screen on load
  showScreen(homeScreen);

})();
</script>

</body>
</html>
